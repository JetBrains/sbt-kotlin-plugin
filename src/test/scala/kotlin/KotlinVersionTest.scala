package kotlin

final class KotlinVersionTest extends munit.FunSuite {
  test("version parsing") {
    intercept[IllegalArgumentException](KotlinVersion("2"))
    intercept[IllegalArgumentException](KotlinVersion("1.8"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-ij243.123.456"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-bin-db-2-fd41f6b"))

    assertEquals(KotlinVersion("1.8.20"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Release, None))
    assertEquals(KotlinVersion("1.8.20-41"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Release, Some("41")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-foo"))
    assertEquals(KotlinVersion("1.8.20-release"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Release, None))
    assertEquals(KotlinVersion("1.8.20-release-52"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Release, Some("52")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-release-bar"))

    assertEquals(KotlinVersion("1.8.20-dev"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Dev, None))
    assertEquals(KotlinVersion("1.8.20-dev-10"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Dev, Some("10")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-dev-foo"))

    assertEquals(KotlinVersion("1.8.20-SNAPSHOT"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Snapshot, None))
    assertEquals(KotlinVersion("1.8.20-Snapshot"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Snapshot, None))
    assertEquals(KotlinVersion("1.8.20-snapshot"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Snapshot, None))
    assertEquals(KotlinVersion("1.8.20-snapshot-10"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Snapshot, Some("10")))
    assertEquals(KotlinVersion("1.8.20-local"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Snapshot, None))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-snapshot-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-local-foo"))

    assertEquals(KotlinVersion("1.8.20-RC"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ReleaseCandidate(None), None))
    assertEquals(KotlinVersion("1.8.20-rc"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ReleaseCandidate(None), None))
    assertEquals(KotlinVersion("1.8.20-RC1"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ReleaseCandidate(Some(1)), None))
    assertEquals(KotlinVersion("1.8.20-rc-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ReleaseCandidate(None), Some("5")))
    assertEquals(KotlinVersion("1.8.20-rc3-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ReleaseCandidate(Some(3)), Some("5")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-rc-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-rc3-bar"))

    assertEquals(KotlinVersion("1.8.20-Beta"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Beta(None), None))
    assertEquals(KotlinVersion("1.8.20-beta"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Beta(None), None))
    assertEquals(KotlinVersion("1.8.20-Beta1"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Beta(Some(1)), None))
    assertEquals(KotlinVersion("1.8.20-Beta-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Beta(None), Some("5")))
    assertEquals(KotlinVersion("1.8.20-beta3-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Beta(Some(3)), Some("5")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-beta-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-Beta3-bar"))

    assertEquals(KotlinVersion("1.8.20-EAP"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Eap(None), None))
    assertEquals(KotlinVersion("1.8.20-eap"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Eap(None), None))
    assertEquals(KotlinVersion("1.8.20-Eap1"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Eap(Some(1)), None))
    assertEquals(KotlinVersion("1.8.20-EAP-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Eap(None), Some("5")))
    assertEquals(KotlinVersion("1.8.20-eap3-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Eap(Some(3)), Some("5")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-eap-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-Eap3-bar"))

    intercept[IllegalArgumentException](KotlinVersion("1.8.20-m"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-M"))
    assertEquals(KotlinVersion("1.8.20-m1"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Milestone(Some(1)), None))
    assertEquals(KotlinVersion("1.8.20-M2"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Milestone(Some(2)), None))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-m-5"))
    assertEquals(KotlinVersion("1.8.20-M3-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.Milestone(Some(3)), Some("5")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-M-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-m3-bar"))

    assertEquals(KotlinVersion("1.8.20-ij243"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ForIde("ij243", Seq(243)), None))
    assertEquals(KotlinVersion("1.8.20-ij243.123"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ForIde("ij243.123", Seq(243, 123)), None))
    assertEquals(KotlinVersion("1.8.20-ij243-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ForIde("ij243", Seq(243)), Some("5")))
    assertEquals(KotlinVersion("1.8.20-ij243.123-5"), new KotlinVersion(1, 8, 20, KotlinVersion.Kind.ForIde("ij243.123", Seq(243, 123)), Some("5")))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-ij243.123-foo"))
    intercept[IllegalArgumentException](KotlinVersion("1.8.20-ij243-bar"))
  }

  test("version comparison") {
    // same version suffixes

    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.21-snapshot"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-snapshot-1"))
    assert(KotlinVersion("1.8.21-snapshot") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-snapshot-1") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-snapshot") == KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-snapshot") == KotlinVersion("1.8.20-local"))

    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-m2"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-m1-1"))
    assert(KotlinVersion("1.8.20-m2") < KotlinVersion("1.8.21-m1"))
    assert(KotlinVersion("1.8.21-m1") > KotlinVersion("1.8.20-m2"))
    assert(KotlinVersion("1.8.20-m1-1") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-m2") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-m1") == KotlinVersion("1.8.20-m1"))

    assert(KotlinVersion("1.8.20-eap1") < KotlinVersion("1.8.20-eap2"))
    assert(KotlinVersion("1.8.20-eap1") < KotlinVersion("1.8.20-eap1-1"))
    assert(KotlinVersion("1.8.20-eap2") < KotlinVersion("1.8.21-eap1"))
    assert(KotlinVersion("1.8.21-eap1") > KotlinVersion("1.8.20-eap2"))
    assert(KotlinVersion("1.8.20-eap1-1") > KotlinVersion("1.8.20-eap1"))
    assert(KotlinVersion("1.8.20-eap2") > KotlinVersion("1.8.20-eap1"))
    assert(KotlinVersion("1.8.20-eap1") == KotlinVersion("1.8.20-eap1"))

    assert(KotlinVersion("1.8.20-beta1") < KotlinVersion("1.8.20-beta2"))
    assert(KotlinVersion("1.8.20-beta1") < KotlinVersion("1.8.20-beta1-1"))
    assert(KotlinVersion("1.8.20-beta2") < KotlinVersion("1.8.21-beta1"))
    assert(KotlinVersion("1.8.21-beta1") > KotlinVersion("1.8.20-beta2"))
    assert(KotlinVersion("1.8.20-beta1-1") > KotlinVersion("1.8.20-beta1"))
    assert(KotlinVersion("1.8.20-beta2") > KotlinVersion("1.8.20-beta1"))
    assert(KotlinVersion("1.8.20-beta1") == KotlinVersion("1.8.20-beta1"))

    assert(KotlinVersion("1.8.20-rc1") < KotlinVersion("1.8.20-rc2"))
    assert(KotlinVersion("1.8.20-rc1") < KotlinVersion("1.8.20-rc1-1"))
    assert(KotlinVersion("1.8.20-rc2") < KotlinVersion("1.8.21-rc1"))
    assert(KotlinVersion("1.8.21-rc1") > KotlinVersion("1.8.20-rc2"))
    assert(KotlinVersion("1.8.20-rc1-1") > KotlinVersion("1.8.20-rc1"))
    assert(KotlinVersion("1.8.20-rc2") > KotlinVersion("1.8.20-rc1"))
    assert(KotlinVersion("1.8.20-rc1") == KotlinVersion("1.8.20-rc1"))

    assert(KotlinVersion("1.8.20") < KotlinVersion("1.8.21"))
    assert(KotlinVersion("1.8.20") < KotlinVersion("1.8.20-1"))
    assert(KotlinVersion("1.8.21") > KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-1") > KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20") == KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-release") == KotlinVersion("1.8.20"))

    assert(KotlinVersion("1.8.20-dev") < KotlinVersion("1.8.21-dev"))
    assert(KotlinVersion("1.8.20-dev") < KotlinVersion("1.8.20-dev-1"))
    assert(KotlinVersion("1.8.21-dev") > KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-dev-1") > KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-dev") == KotlinVersion("1.8.20-dev"))

    assert(KotlinVersion("1.8.20-ij242") < KotlinVersion("1.8.20-ij243"))
    assert(KotlinVersion("1.8.20-ij242") < KotlinVersion("1.8.20-ij242-1"))
    assert(KotlinVersion("1.8.20-ij243") < KotlinVersion("1.8.21-ij242"))
    assert(KotlinVersion("1.8.21-ij242") > KotlinVersion("1.8.20-ij243"))
    assert(KotlinVersion("1.8.20-ij242-1") > KotlinVersion("1.8.20-ij242"))
    assert(KotlinVersion("1.8.20-ij243") > KotlinVersion("1.8.20-ij242"))
    assert(KotlinVersion("1.8.20-ij243") == KotlinVersion("1.8.20-ij243"))

    assert(KotlinVersion("1.8.20-ij242.123") < KotlinVersion("1.8.20-ij243.123"))
    assert(KotlinVersion("1.8.20-ij242.123") < KotlinVersion("1.8.20-ij242.123-1"))
    assert(KotlinVersion("1.8.20-ij242.123") < KotlinVersion("1.8.20-ij242.124"))
    assert(KotlinVersion("1.8.20-ij243.123") < KotlinVersion("1.8.21-ij242.123"))
    assert(KotlinVersion("1.8.20-ij242.123") > KotlinVersion("1.8.20-ij242.24"))
    assert(KotlinVersion("1.8.20-ij242.123-1") > KotlinVersion("1.8.20-ij242.123"))
    assert(KotlinVersion("1.8.21-ij242.123") > KotlinVersion("1.8.20-ij243.123"))
    assert(KotlinVersion("1.8.20-ij243.123") > KotlinVersion("1.8.20-ij242.123"))
    assert(KotlinVersion("1.8.20-ij243.123") == KotlinVersion("1.8.20-ij243.123"))

    assert(KotlinVersion("1.8.20-ij243") < KotlinVersion("1.8.20-ij243.1"))
    assert(KotlinVersion("1.8.20-ij243.1") > KotlinVersion("1.8.20-ij243"))
    assert(KotlinVersion("1.8.20-ij243-1") < KotlinVersion("1.8.20-ij243.1"))
    assert(KotlinVersion("1.8.20-ij243.1") > KotlinVersion("1.8.20-ij243-1"))
    assert(KotlinVersion("1.8.20-ij243-1") < KotlinVersion("1.8.20-ij243.1-1"))
    assert(KotlinVersion("1.8.20-ij243.1-1") > KotlinVersion("1.8.20-ij243-1"))
    assert(KotlinVersion("1.8.20-ij243") < KotlinVersion("1.8.20-ij243.1-1"))
    assert(KotlinVersion("1.8.20-ij243.1-1") > KotlinVersion("1.8.20-ij243"))


    // different version suffixes (snapshot < everything else)
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-snapshot") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < everything else)
    assert(KotlinVersion("1.8.20-m1") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-m1") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < eap < everything else)
    assert(KotlinVersion("1.8.20-eap") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-eap") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-eap") < KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-eap") < KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-eap") < KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-eap") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-eap") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < eap < beta < everything else)
    assert(KotlinVersion("1.8.20-beta") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-beta") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-beta") > KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-beta") < KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-beta") < KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-beta") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-beta") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < eap < beta < rc < everything else)
    assert(KotlinVersion("1.8.20-rc") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-rc") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-rc") > KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-rc") > KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-rc") < KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-rc") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20-rc") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < eap < beta < rc < release < everything else)
    assert(KotlinVersion("1.8.20") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20") > KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20") > KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20") > KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20") < KotlinVersion("1.8.20-dev"))
    assert(KotlinVersion("1.8.20") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (snapshot < milestone < eap < beta < rc < release < dev < everything else)
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-dev") > KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-dev") < KotlinVersion("1.8.20-ij123"))

    // different version suffixes (everything else < for ide)
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-snapshot"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-m1"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-eap"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-beta"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-rc"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20"))
    assert(KotlinVersion("1.8.20-ij123") > KotlinVersion("1.8.20-dev"))
  }
}
